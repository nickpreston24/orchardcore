@page
@using Orchard.Sandbox.Pages.Components
@using Orchard.Sandbox.Services
@using CodeMechanic.Types
@using Hydro.TagHelpers
@using Newtonsoft.Json
@model IndexModel
@inject ICalendarEventService calendar_service

@{
    var all_events = await calendar_service.GetAll();
}

<div
    x-data="{
        edits_enabled: true,
        index: 0,
        date_value: Date.now, 
        next_event: {
            title: 'csharp event',
            start: Date.now,
            allDay: true
        },
        selected_event: {},
        options_panel: {
            kinds: {show:true}        
        }
    }"
    class="flex flex-row gap-2">

    <section class="w-2/3">
        <hydro name="HydroCalendar" params="@(new { Events = all_events.ToArray() })"/>
    </section>

    <section class="w-1/3">
        <hydro name="HydroOptionsPanel"/>
    </section>

    @* <button x-on:click="edits_enabled='true'"> toggle edit moed</button> *@











    @* <h1 x-show="false">OOB Swap Test</h1> *@
    @* *@
    @* <HtmxSwappable *@
    @*     x-show="false" *@
    @*     TargetId="alert-container" SwapStyle="SwapStyle.InnerHTML" Selector=".alert-message"> *@
    @*     <div class="alert alert-info" role="alert"> *@
    @*         This is an important message! *@
    @*     </div> *@
    @*     <div class="alert alert-info" role="alert"> *@
    @*         This is ALSO an important message! *@
    @*     </div> *@
    @* </HtmxSwappable> *@
</div>


@* <partial name="_RenderCalendar"></partial> *@


@* <div> *@
@*     <script> *@
@* *@
@*     document.addEventListener('DOMContentLoaded', function() { *@
@*     var calendarEl = document.getElementById('calendar'); *@
@*      *@
@*     var calendar = new FullCalendar.Calendar(calendarEl, { *@
@*         // defaultView: 'agendaWeek', *@
@*         initialView: 'dayGridMonth', *@
@*             headerToolbar: { *@
@*               center: 'addEventButton' *@
@*             },         *@
@*              *@
@*             customButtons: { *@
@*                   addEventButton: { *@
@*                     text: 'add event...', *@
@*                     click: function() { *@
@*                       var dateStr = prompt('Enter a date in YYYY-MM-DD format'); *@
@*                       var date = new Date(dateStr + 'T00:00:00'); // will be in local time *@
@*              *@
@*                       if (!isNaN(date.valueOf())) { // valid? *@
@*                           var nextevent = { *@
@*                                             title: 'dynamic event', *@
@*                                             start: date, *@
@*                                             allDay: true *@
@*                                           } *@
@*                         // alert('Great. Now, update your database...'); *@
@*                          @(await calendar_service.Create("create_calendar_event.sql", new CalendarEvent() *@
@*                          { *@
@*                              event_name = "dynamic event", *@
@*                              description = "dynamic event", *@
@*                              // start_date =  date, *@
@*                              // allDay: true *@
@*                          })) *@
@*                          *@
@*                         calendar.addEvent(nextevent); *@
@* *@
@*                       } else { *@
@*                         alert('Invalid date.'); *@
@*                       } *@
@*                     } *@
@*                   } *@
@*                 }        *@
@*          }); *@
@*      *@
@*      *@
@*      *@
@*     calendar.on('dateClick', function(info) { *@
@*          console.log('Clicked on: ' + info.dateStr); *@
@*          console.log('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY); *@
@*          console.log('Current view: ' + info.view.type); *@
@*                  *@
@*         // edits_enabled = true; *@
@*     }); *@
@*      *@
@*     // function add_htmx_attributes(element) { *@
@*     //     element.setAttribute("hx-get", ""); *@
@*     //     element.setAttribute("hx-target", '#result'); *@
@*     //     element.setAttribute("hx-page", 'Index'); *@
@*     //     element.setAttribute("hx-page-handler", 'RepaintCalendar'); *@
@*     // } *@
@*      *@
@*     function render() { *@
@*         console.log('rendering calendar ...'); *@
@*         calendar.render(); *@
@*     } *@
@*     render(); *@
@*     // var addeventbtnEl = document.getElementsByClassName( 'fc-addEventButton-button fc-button fc-button-primary')[0] *@
@* *@
@*     // add_htmx_attributes(addeventbtnEl) *@
@*     // window.render= render; *@
@*     // window.add_htmx_attributes = add_htmx_attributes; *@
@*      *@
@* }); *@
@* *@
@* </script> *@
@* *@
@* </div> *@
@* *@
@* <div id="calendar"></div> *@