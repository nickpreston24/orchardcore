@page
@using Orchard.Sandbox.Services
@using Hydro.TagHelpers
@model IndexModel
@inject ICalendarEventService calendar_service

@{
    var all_events = await calendar_service.GetAll();
    // string current_handler = Model.Handler;
    var published_events = await calendar_service.Search(new CalendarEvent() { status = "published" });
}

<div
    x-data="setup()"
    class="flex flex-row gap-2">

    <section class="w-2/3">
        <hydro name="HydroCalendar" params="@(new { Events = all_events.ToArray() })"/>
    </section>

    <section class="w-1/3">

        <join>

            <button class="btn join-item" x-on:click="options_panel.addbutton.show=!options_panel.addbutton.show"
                    hx-get
                    hx-target="#create_form"
                    :class="options_panel.addbutton.classname"
                    hx-page-handler="CreateForm">
                Add
            </button>
            <button class="btn join-item"
                    :class="options_panel.dangerbutton.classname"
                    x-on:click="options_panel.dangerbutton.show=!options_panel.dangerbutton.show">
                Danger Zone
            </button>

            @* <input class="join-item btn" type="radio" name="options" aria-label="Radio 1"/> *@
            @* <input class="join-item btn" type="radio" name="options" aria-label="Radio 2"/> *@
            @* <input class="join-item btn" type="radio" name="options" aria-label="Radio 3"/> *@
        </join>
        <div id="create_form"
             x-show="options_panel.addbutton.show">
            <partial name="_CreateEventForm" model="@Model"></partial>
        </div>

        <div x-show="options_panel.dangerbutton.show" class="border-error border-2">
            <p class="alert alert-ghost border-warning border-4">
                ⚠️
                WARNING - This is the Danger Zone! Anything you do here is PERMANENT!
            </p>

            <button class="btn btn-error"
                    hx-get
                    hx-target="#delete_message"
                    hx-page-handler="DeleteAll">
                Delete All Events
            </button>
            <span id="delete_message"></span>
        </div>

        @* <hydro name="HydroOptionsPanel"/> *@

        @* Story:  "I can see a list of all events"  *@
        <hydro name="HydroEventList"/>
    </section>

</div>

<script >
function setup(){
    return {
       edits_enabled: true,
       date_value: Date.now, 
       next_event: {
           title: '',
           Description: '',
           start: Date.now,
           allDay: true
       },
       selected_event: {},
       current_handler: 'SaveEvent',
       options_panel: {
           show_kinds: true,
           show_edit_form: false,    
           show_actions_menu: false,
           
           dangerbutton: {
            show: false,
             get classname() {
              return this.show ? 'btn btn-secondary join-item' : 'btn join-item'
             }
           },
           addbutton: {
              show: false,
              get classname() {
               return this.show ? 'btn btn-secondary join-item' : 'btn join-item'
              }
           }
       },
     
   }    
}
</script>