@page
@using Orchard.Sandbox.Services
@using Hydro.TagHelpers
@model IndexModel
@inject ICalendarEventService calendar_service

@{
    var all_events = await calendar_service.GetAll();
    // string current_handler = Model.Handler;
}

<div
    x-data="setup()"
    class="flex flex-row gap-2">

    <section class="w-2/3">
        <hydro name="HydroCalendar" params="@(new { Events = all_events.ToArray() })"/>
    </section>

    <section class="w-1/3">

        <button class="btn btn-accent" x-on:click="options_panel.show_add_form=true"
                hx-get
                hx-target="#create_form"
                :class="addbutton"
                hx-page-handler="CreateForm">
            Add
        </button>
        <button class="btn btn-error"
                x-on:click="options_panel.show_admin_danger_zone=!options_panel.show_admin_danger_zone">
            Danger Zone
        </button>
        <div id="create_form"
             x-show="options_panel.show_add_form">
            <partial name="_CreateEventForm" model="@Model"></partial>
        </div>

        <div x-show="options_panel.show_admin_danger_zone" class="border-error border-2">
            <p class="alert alert-ghost border-warning border-4">
                ⚠️
                WARNING - This is the Danger Zone! Anything you do here is PERMANENT!
            </p>

            <button class="btn btn-error"
                    hx-get
                    hx-target="#delete_message"
                    hx-page-handler="DeleteAll">
                Delete All Events
            </button>
            <span id="delete_message"></span>
        </div>

        @* <hydro name="HydroOptionsPanel"/> *@
    </section>

</div>

<script >
function setup(){
    return {
       edits_enabled: true,
       date_value: Date.now, 
       next_event: {
           title: '',
           Description: '',
           start: Date.now,
           allDay: true
       },
       selected_event: {},
       current_handler: 'SaveEvent',
       options_panel: {
           show_kinds: true,
           show_edit_form: false,    
           show_add_form: false,    
           show_actions_menu: false,
           show_admin_danger_zone: false
       },
       get addbutton() {
           return 'btn btn-secondary'
       }
   }    
}
</script>