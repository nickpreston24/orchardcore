@page
@using Orchard.Sandbox.Services
@using Hydro.TagHelpers
@model IndexModel
@inject ICalendarEventService calendar_service

@{
    var all_events = await calendar_service.GetAll();
    // string current_handler = Model.Handler;
}

<div
    x-data="setup()"
    class="flex flex-row gap-2">

    <section class="w-2/3">
        <hydro name="HydroCalendar" params="@(new { Events = all_events.ToArray() })"/>
    </section>

    <section class="w-1/3">

        <button class="btn btn-accent" x-on:click="options_panel.show_add_form=true"
                hx-get
                hx-target="#create_form"
                :class="addbutton"
                hx-page-handler="CreateForm">
            Add
        </button>
        <button class="btn btn-error"
                x-on:click="options_panel.show_admin_danger_zone=!options_panel.show_admin_danger_zone">
            Danger Zone
        </button>
        <div id="create_form"
             x-show="options_panel.show_add_form">
            <partial name="_CreateEventForm" model="@Model"></partial>
        </div>

        <div x-show="options_panel.show_admin_danger_zone" class="border-error border-2">
            <p class="alert alert-ghost border-warning border-4">
                ⚠️
                WARNING - This is the Danger Zone! Anything you do here is PERMANENT!
            </p>


            <button class="btn btn-error"
                    hx-get
                    hx-target="#delete_message"
                    hx-page-handler="DeleteAll">
                Delete All Events
            </button>
            <span id="delete_message"></span>
        </div>

        @* <hydro name="HydroOptionsPanel"/> *@
    </section>

</div>

<script >
function setup(){
    return {
       edits_enabled: true,
       index: 0,
       date_value: Date.now, 
       next_event: {
           title: '',
           Description: '',
           start: Date.now,
           allDay: true
       },
       selected_event: {},
       current_handler: 'SaveEvent',
       options_panel: {
           show_kinds: true,
           show_edit_form: false,    
           show_add_form: false,    
           show_actions_menu: false,
           show_admin_danger_zone: false
       },
       get addbutton() {
           return 'btn btn-secondary'
       }
   }    
}
</script>


@* <partial name="_RenderCalendar"></partial> *@


@* <div> *@
@*     <script> *@
@* *@
@*     document.addEventListener('DOMContentLoaded', function() { *@
@*     var calendarEl = document.getElementById('calendar'); *@
@*      *@
@*     var calendar = new FullCalendar.Calendar(calendarEl, { *@
@*         // defaultView: 'agendaWeek', *@
@*         initialView: 'dayGridMonth', *@
@*             headerToolbar: { *@
@*               center: 'addEventButton' *@
@*             },         *@
@*              *@
@*             customButtons: { *@
@*                   addEventButton: { *@
@*                     text: 'add event...', *@
@*                     click: function() { *@
@*                       var dateStr = prompt('Enter a date in YYYY-MM-DD format'); *@
@*                       var date = new Date(dateStr + 'T00:00:00'); // will be in local time *@
@*              *@
@*                       if (!isNaN(date.valueOf())) { // valid? *@
@*                           var nextevent = { *@
@*                                             title: 'dynamic event', *@
@*                                             start: date, *@
@*                                             allDay: true *@
@*                                           } *@
@*                         // alert('Great. Now, update your database...'); *@
@*                          @(await calendar_service.Create("create_calendar_event.sql", new CalendarEvent() *@
@*                          { *@
@*                              event_name = "dynamic event", *@
@*                              description = "dynamic event", *@
@*                              // start_date =  date, *@
@*                              // allDay: true *@
@*                          })) *@
@*                          *@
@*                         calendar.addEvent(nextevent); *@
@* *@
@*                       } else { *@
@*                         alert('Invalid date.'); *@
@*                       } *@
@*                     } *@
@*                   } *@
@*                 }        *@
@*          }); *@
@*      *@
@*      *@
@*      *@
@*     calendar.on('dateClick', function(info) { *@
@*          console.log('Clicked on: ' + info.dateStr); *@
@*          console.log('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY); *@
@*          console.log('Current view: ' + info.view.type); *@
@*                  *@
@*         // edits_enabled = true; *@
@*     }); *@
@*      *@
@*     // function add_htmx_attributes(element) { *@
@*     //     element.setAttribute("hx-get", ""); *@
@*     //     element.setAttribute("hx-target", '#result'); *@
@*     //     element.setAttribute("hx-page", 'Index'); *@
@*     //     element.setAttribute("hx-page-handler", 'RepaintCalendar'); *@
@*     // } *@
@*      *@
@*     function render() { *@
@*         console.log('rendering calendar ...'); *@
@*         calendar.render(); *@
@*     } *@
@*     render(); *@
@*     // var addeventbtnEl = document.getElementsByClassName( 'fc-addEventButton-button fc-button fc-button-primary')[0] *@
@* *@
@*     // add_htmx_attributes(addeventbtnEl) *@
@*     // window.render= render; *@
@*     // window.add_htmx_attributes = add_htmx_attributes; *@
@*      *@
@* }); *@
@* *@
@* </script> *@
@* *@
@* </div> *@
@* *@
@* <div id="calendar"></div> *@